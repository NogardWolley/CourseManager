<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="xmu.crms.mapper.CourseMapper">
    <!--根据教师查找Course<List>-->
    <resultMap type="Course" id="CourseList">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="start_date" property="startDate"/>
        <result column="end_date" property="endDate"/>
        <result column="teacher_id" property="teacher"/>
        <result column="description" property="description"/>
        <result column="report_percentage" property="reportPercentage"/>
        <result column="presentation_percentage" property="presentationPercentage"/>
        <result column="five_point_percentage" property="fivePointPercentage"/>
        <result column="four_point_percentage" property="fourPointPercentage"/>
        <result column="three_point_percentage" property="threePointPercentage"/>
    </resultMap>

    <resultMap type="ClassInfo" id="ClassInfoList">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="site" property="site"/>
        <result column="class_time" property="classTime"/>
        <result column="report_percentage" property="reportPercentage"/>
        <result column="presentation_percentage" property="presentationPercentage"/>
        <result column="five_point_percentage" property="fivePointPercentage"/>
        <result column="four_point_percentage" property="fourPointPercentage"/>
        <result column="three_point_percentage" property="threePointPercentage"/>
        <association column="course_id" property="course" select="selectCourseById"/>
    </resultMap>

    <resultMap type="User" id="UserList">
        <id column="id" property="id"/>
        <result column="phone" property="phone"/>
        <result column="wechat_id" property="wechatId"/>
        <result column="openid" property="openid"/>
        <result column="avatar" property="avatar"/>
        <result column="password" property="password"/>
        <result column="name" property="name"/>
        <result column="gender" property="gender"/>
        <result column="type" property="type"/>
        <result column="number" property="number"/>
        <result column="education" property="education"/>
        <result column="title" property="title"/>
        <result column="email" property="email"/>
        <association column="school_id" property="school" select="selectSchoolById"/>
    </resultMap>

    <resultMap id="courseResultMap" type="xmu.crms.entity.Course">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="start_date" property="startDate" jdbcType="DATE"/>
        <result column="end_date" property="endDate" jdbcType="DATE"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
        <result column="report_percentage" property="reportPercentage" jdbcType="TINYINT" />
        <result column="presentation_percentage" property="presentationPercentage" jdbcType="TINYINT" />
        <result column="five_point_percentage" property="fivePointPercentage" jdbcType="TINYINT" />
        <result column="four_point_percentage" property="fourPointPercentage" jdbcType="TINYINT" />
        <result column="three_point_percentage" property="threePointPercentage" jdbcType="TINYINT" />
        <association column="teacher_id" property="teacher" javaType="xmu.crms.entity.User" select="selectUserById"/>
    </resultMap>

    <resultMap id="userResultMap" type="xmu.crms.entity.User">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="phone" property="phone" jdbcType="CHAR"/>
        <result column="wechat_id" property="wechatId" jdbcType="VARCHAR"/>
        <result column="openid" property="openid" jdbcType="VARCHAR"/>
        <result column="avatar" property="avatar" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="gender" property="gender" jdbcType="TINYINT" />
        <result column="type" property="type" jdbcType="TINYINT" />
        <result column="number" property="number" jdbcType="TINYINT" />
        <result column="education" property="education" jdbcType="TINYINT" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="email" property="email" jdbcType="VARCHAR" />
        <association column="school_id" property="school" javaType="xmu.crms.entity.School"  select="selectSchoolById"/>
    </resultMap>

    <resultMap id="schoolResultMap" type="xmu.crms.entity.School">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="province" property="province" jdbcType="VARCHAR" />
        <result column="city" property="city" jdbcType="VARCHAR" />
    </resultMap>

    <select id="listCourseByUserId" resultMap="CourseList">
        SELECT id,name,start_date,end_date.decsription,report_percentage,presentation_percentage,five_point_percentage,four_point_percentage,three_point_percentage
        FROM course
        WHERE teacher_id=#{id}
    </select>

    <insert id="insertCourseByUserId" parameterType="xmu.crms.entity.Course" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO
        course(
        name,
        start_date,
        end_date,
        teacher_id,
        description,
        report_percentage,
        presentation_percentage,
        five_point_percentage,
        four_point_percentage,
        three_point_percentage
        )
        VALUES (
        #{name},
        #{startDate},
        #{endDate},
        #{teacher},
        #{description},
        #{reportionPercentage},
        #{persentationPercentage},
        #{fivePointPercentage},
        #{fourPointPercentage},
        #{threePointPercentage}
        )
        </insert>

    <select id="getCourseByCourseId" parameterType="java.math.BigInteger" resultMap="CourseList">
        SELECT id,name,start_date,end_date.decsription,report_percentage,presentation_percentage,five_point_percentage,four_point_percentage,three_point_percentage
        FROM course
        WHERE id=#{id,jdbcType=BIGINT}
    </select>

    <update id="updateCourseByCourseId">
        UPDATE course
        SET
        <if test="name!=null"> name = #{name,jdbcType=VARCHAR },</if>
        <if test="start_date!=null">start_date = #{startDate,jdbcType=DATE }，</if>
        <if test="end_date!=null">end_date = #{endDate,jdbcType=DATE },</if>
        <if test="teacher_id!=null">teacher_id = #{teacher,jdbcType=BIGINT },</if>
        <if test="description!=null">description = #{description,jdbcType=VARCHAR },</if>
        <if test="report_percentage!=null">report_percentage = #{reportPercentage,jdbcType=INTEGER },</if>
        <if test="presentation_percentage!=null">presentation_percentage = #{presentationPercentage,jdbcType=INTEGER },</if>
        <if test="five_point_percentage!=null">five_point_percentage = #{fivePointPercentage,jdbcType=INTEGER },</if>
        <if test="four_point_percentage!=null">four_point_percentage = #{fourPointPercentage,jdbcType=INTEGER },</if>
        <if test="three_point_percentage!=null">three_point_percentage = #{threePointPercentage,jdbcType=INTEGER },</if>
        WHERE id = #{id,jdbcType=BIGINT}
    </update>

    <delete id="deleteCourseByCourseId" parameterType="java.math.BigInteger">
        DELETE FROM course
        WHERE id = #{id,jdbcType=BIGINT}
    </delete>

    <select id="listCourseByCourseName" parameterType="java.lang.String" resultMap="CourseList">
        SELECT id,name,start_date,end_date,teacher_id,description,report_percentage,presentation_percentage,five_point_percentage,four_poing_percentage,three_point_percentage
        FROM course
        WHERE name = #{name,jdbcType=VARCHAR}
    </select>

    <select id="listCourseIdByCourseName" parameterType="java.lang.String" resultMap="CourseList">
        SELECT  id
        FROM course
        WHERE name = #{name,jdbcType=VARCHAR}
    </select>

    <select id="listClassByCourseId" parameterType="java.math.BigInteger" resultMap="ClassInfoList">
        SELECT id,name,site,class_time,report_percentage,presentation_percentage,five_point_percentage,four_poing_percentage,three_point_percentage
        FROM class_info
        WHERE course_id = #{id,jdbcType=BIGINT}
    </select>

    <select id="getUserIdByUserName" parameterType="java.lang.String" resultMap="UserList">
            SELECT id
            FROM user_info
            WHERE name = #{name,jdbcType=VARCHAR}
    </select>

    <select id="listCourseIdByTeacherId" parameterType="java.math.BigInteger" resultMap="CourseList">
        SELECT id
        FROM course
        WHERE teacher_id=#{teacher,jdbcType=BIGINT}
    </select>

    <select id="selectCourseById" resultMap="courseResultMap">
        SELECT id,name,start_date,end_date,teacher_id,description,report_percentage,presentation_percentage,five_point_percentage,four_point_percentage,three_point_percentage
        FROM course
        WHERE id=#{id}
    </select>

    <select id="selectCourseById" resultMap="courseResultMap">
        SELECT id,name,start_date,end_date,teacher_id,description,report_percentage,presentation_percentage,five_point_percentage,four_point_percentage,three_point_percentage
        FROM course
        WHERE id=#{id}
    </select>
    <select id="selectUserById" resultMap="userResultMap">
        SELECT id,phone,wechat_id,openid,avatar,password,name,school_id,gender,type,number,education,title,email
        FROM user_info
        WHERE id=#{id}
    </select>
</mapper>